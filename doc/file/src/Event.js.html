<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Event.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/thegroundwork/groundwork.js.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Auth.js~Auth.html">Auth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Dictionary.js~Dictionary.html">Dictionary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Donation.js~Donation.html">Donation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Event.js~Event.html">Event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/EventCategory.js~EventCategory.html">EventCategory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/EventInvitation.js~EventInvitation.html">EventInvitation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/EventMessage.js~EventMessage.html">EventMessage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/EventTicket.js~EventTicket.html">EventTicket</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Groundwork.js~Groundwork.html">Groundwork</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Http.js~Http.html">Http</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Payment.js~Payment.html">Payment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Profile.js~Profile.html">Profile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Quickcard.js~Quickcard.html">Quickcard</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/SchemaUtils.js~SchemaUtils.html">SchemaUtils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Subscription.js~Subscription.html">Subscription</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Supporter.js~Supporter.html">Supporter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-deprecate">deprecate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-epoch">epoch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-has">has</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isApiVersion">isApiVersion</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isEmpty">isEmpty</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-max">max</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mixin">mixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-normalizeUrl">normalizeUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-only">only</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-urlJoin">urlJoin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validEmail">validEmail</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_CATEGORY">ENDPOINT_CATEGORY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_EVENT">ENDPOINT_EVENT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_HOST_UNSUBSCRIBE">ENDPOINT_HOST_UNSUBSCRIBE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_INVITATION">ENDPOINT_INVITATION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_MESSAGE">ENDPOINT_MESSAGE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_TICKET">ENDPOINT_TICKET</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NAMESPACE">NAMESPACE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_URL">API_URL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_VERSION">API_VERSION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTH_ACCESS_TOKEN">AUTH_ACCESS_TOKEN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTH_GWID">AUTH_GWID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTH_TOKEN_TYPE">AUTH_TOKEN_TYPE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CONFIG_AUTH">CONFIG_AUTH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_API_URL">DEFAULT_API_URL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FACEBOOK_APP_ID">FACEBOOK_APP_ID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-OAUTH_CLIENT_ID">OAUTH_CLIENT_ID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RE_API_VERSION">RE_API_VERSION</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Event.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Dictionary from &apos;./Dictionary&apos;;
import Http from &apos;./Http&apos;;
import SchemaUtils from &apos;./SchemaUtils&apos;;
import EventCategory from &apos;./EventCategory&apos;;
import EventInvitation from &apos;./EventInvitation&apos;;
import EventMessage from &apos;./EventMessage&apos;;
import EventTicket from &apos;./EventTicket&apos;;
import eventSchema from &apos;./schema/event&apos;;
import { mixin, only, urlJoin, validEmail } from &apos;./utils&apos;;

/** @type {String} - API endpoint for resource */
export const NAMESPACE = &apos;events&apos;;

/** @type {String} - API endpoint for event resource */
export const ENDPOINT_EVENT = &apos;events&apos;;

/** @type {String} - API endpoint for category resource */
export const ENDPOINT_CATEGORY = &apos;categories&apos;;

/** @type {String} - API endpoint for invitation resource */
export const ENDPOINT_INVITATION = &apos;invitations&apos;;

/** @type {String} - API endpoint for message resource */
export const ENDPOINT_MESSAGE = &apos;messages&apos;;

/** @type {String} - API endpoint for ticket resource */
export const ENDPOINT_TICKET = &apos;tickets&apos;;

/** @type {String} - API endpoint for unsubscribing an email address */
export const ENDPOINT_HOST_UNSUBSCRIBE = &apos;host-unsubscribe&apos;;

/**
 * An Event is a time and a place of an event. It also encompasses an event&apos;s
 * title and description.
 *
 * @example
 * const gw = new Groundwork({...});
 *
 * // List all events, while passing in an optional config
 * gw.events.list({ page: 2, perPage: 10 })
 *   .then((response) =&gt; console.log(response))
 *   .catch((err) =&gt; console.error(err));
 *
 * gw.events.fetch(&lt;event id&gt;)
 *   .then((response) =&gt; console.log(response))
 *   .catch((err) =&gt; console.error(err));
 *
 * // Create a new event with required properties
 * const eventProps = {
 *   address1: &apos;641 Walnut St.&apos;,
 *   addressCity: &apos;Cincinnati&apos;,
 *   addressCountry: &apos;USA&apos;,
 *   addressPostalCode: &apos;45202&apos;,
 *   addressStateOrProvince: &apos;Ohio&apos;,
 *   description: &apos;Come watch the Democratic and Republican candidates debate!&apos;,
 *   locationName: &apos;The Righteous Room&apos;,
 *   timeEnd: &apos;2016-09-26T15:00:00&apos;,
 *   timeStart: &apos;2016-09-26T12:00:00&apos;,
 *   title: &apos;Debate Watch Party at The Righteous Room&apos;
 * };
 *
 * gw.events.create(eventProps)
 *   .then((response) =&gt; console.log(response))
 *   .catch((err) =&gt; console.error(err));
 *
 * gw.events.update({ description: &apos;updated description&apos; })
 *   .then((response) =&gt; console.log(response))
 *   .catch((err) =&gt; console.error(err));
 *
 * gw.events.replace({...})
 *   .then((response) =&gt; console.log(response))
 *   .catch((err) =&gt; console.error(err));
 *
 * gw.events.delete(&lt;event id&gt;)
 *   .then((response) =&gt; console.log(response))
 *   .catch((err) =&gt; console.error(err));
 *
 * // If authenticated, list all tickets across all events,
 * gw.events.listAllTickets({...})
 *   .then((response) =&gt; console.log(response))
 *   .catch((err) =&gt; console.error(error))
 *
 * gw.events.unsubscribe(&lt;email&gt;, &lt;invitationId&gt;)
 * 	 .then((response) =&gt; console.log(response))
 * 	 .catch((err) =&gt; console.error(err))
 */
class Event {
  /**
   * @param {Dictionary} [config] - configuration dictionary
   * @param {Http} http - Http instance
   */
  constructor(config, http) {
    /** @type {Dictionary} */
    this.config = (config &amp;&amp; config instanceof Dictionary) ?
      config : new Dictionary();

    // Resource must have an Http instance
    if (!http || http instanceof Http === false) {
      throw new Error(&apos;Event requires Http&apos;);
    }

    /** @type {Http} */
    this.http = http;

    /** @type {SchemaUtils} */
    this.schemaUtils = SchemaUtils;
  }

  /**
   * Validate a payload against a schema. If it fails then return a tuple
   * with a rejected Promise containing an error message.
   *
   * @param {Object} [payload]
   * @param {Object} schema
   * @return {Array}
   */
  validatePayload(payload = {}, schema) {
    let out = [true];
    const valid = this.schemaUtils.validateSchema(payload, schema);

    if (valid.length &gt; 0) {
      const ret = this.http.generateErrorObject();
      valid.forEach((err) =&gt; {
        ret.msg.push(err.message);
        ret.fields.push(this.schemaUtils.extractFieldByError(err));
      });
      out = [false, Promise.reject(this.http.generateErrorResponse(ret))];
    }
    return out;
  }

  /**
   * If a specific function argument is missing then send back a tuple with a
   * rejected Promise containing an error message.
   *
   * @param {*} id - value to check
   * @param {String} [name] - name of argument being checked
   * @return {Array}
   */
  validateId(id, name = &apos;&apos;) {
    let out = [true];

    if (typeof id !== &apos;string&apos; || id === null || id === undefined || id === false) {
      const response = this.http.generateErrorResponse({
        valid: false,
        fields: [name],
        msg: [`Invalid ID: ${name}`]
      });
      out = [false, Promise.reject(response)];
    }

    return out;
  }

  /**
   * List all Events
   *
   * @param {Object} [opts] - options object
   * @param {Array|String} [opts.hostGwid] -
   *   The GWID String of the user who is hosting the event. Only events with the given
   *   hostGwid will be returned. You may also pass multiple hostGwid&apos;s in an array
   *   include multiple hosts in your request
   * @param {Boolean} [opts.isDeleted] -
   *   a Boolean of whether to only return Events that have been deleted. Defaults to
   *   False. This option is currently only available to Admin users
   * @param {Number} [opts.latitude] -
   *   a numeric Float of a latitudinal geographic coordinate by which to filter results.
   *   This parameter must be provided if performing a geographic filter
   * @param {Number} [opts.longitude] -
   *   a numeric Float of a longitudinal geographic coordinate by which to filter results.
   *   This parameter must be provided if performing a geographic filter
   * @param {Number} [opts.page] -
   *   an Integer indicating which page of results should be returned
   * @param {Number} [opts.perPage] -
   *   an Integer indicating how many results should be returned per request
   * @param {Number} [opts.radius] -
   *   a numeric Float, given in kilometers, of the search radius by with to filter results.
   *   This parameter must be provided if performing a geographic filter.
   * @param {String} [opts.search] - a String search field that will query Event titles.
   * @param {String} [opts.startsBefore] -
   *   an ISO-8601 formatted String given in local time without a timezone designator.
   *   Only events occuring before the given timestamp will be returned.
   * @param {String} [opts.startsAfter] -
   *   an ISO-8601 formatted String given in local time without a timezone designator.
   *   Only events occuring after the given timestamp will be returned.
   * @return {Promise}
   */
  list(opts = {}) {
    const _opts = only([&apos;hostGwid&apos;, &apos;isDeleted&apos;, &apos;latitude&apos;, &apos;longitude&apos;, &apos;page&apos;,
                        &apos;perPage&apos;, &apos;radius&apos;, &apos;search&apos;, &apos;startsBefore&apos;,
                        &apos;startsAfter&apos;], opts);

    const url = urlJoin(NAMESPACE, ENDPOINT_EVENT);
    return this.http.get(url, { params: _opts });
  }

  /**
   * Get a specific Event, by id
   *
   * @param  {String} eventId - id of event
   * @return {Promise}
   */
  fetch(eventId) {
    const [ev, ep] = this.validateId(eventId, &apos;eventId&apos;);
    if (!ev) { return ep; }

    const url = urlJoin(NAMESPACE, ENDPOINT_EVENT, eventId);
    return this.http.get(url);
  }

  /**
   * Create an Event
   *
   * The provided address will be geocoded to discover timezone information. If the
   * geocode fails, the request will fail and the Event will not be created.
   *
   * @param  {Object} [event] - event object
   * @return {Promise}
   */
  create(event = {}) {
    const [eventv, eventp] = this.validatePayload(event, eventSchema);
    if (!eventv) { return eventp; }

    const url = urlJoin(NAMESPACE, ENDPOINT_EVENT);
    return this.http.post(url, event);
  }

  /**
   * Update an existing Event, by id
   *
   * Only the fields that are passed will be updated.
   *
   * If the address field is modified in full or in part, it will be re-geocoded to
   * update timezone information. If the geocode fails, the request will fail and the
   * Event will not be modified.
   *
   * @param  {String} eventId - id of event
   * @param  {Object} [event] - fields to update
   * @return {Promise}
   */
  update(eventId, event = {}) {
    const [ev, ep] = this.validateId(eventId, &apos;eventId&apos;);
    if (!ev) { return ep; }

    const url = urlJoin(NAMESPACE, ENDPOINT_EVENT, eventId);
    return this.http.patch(url, event);
  }

  /**
   * Replace an existing Event, by id
   *
   * All fields are updated. If an optional field is not provided, it will be overwritten
   * as blank unless otherwise noted.
   *
   * If the address field is modified in full or in part, it will be re-geocoded to
   * update timezone information. If the geocode fails, the request will fail and the
   * Event will not be modified.
   *
   * @param  {String} eventId - id of event
   * @param  {Object} [event] - fields to update
   * @return {Promise}
   */
  replace(eventId, event = {}) {
    const [ev, ep] = this.validateId(eventId, &apos;eventId&apos;);
    if (!ev) { return ep; }

    const [eventv, eventp] = this.validatePayload(event, eventSchema);
    if (!eventv) { return eventp; }

    const url = urlJoin(NAMESPACE, ENDPOINT_EVENT, eventId);
    return this.http.put(url, event);
  }

  /**
   * Delete a specific Event, by id
   *
   * If there are Tickets associated with any Categories under that event, the request
   * will fail.
   *
   * @param  {String} eventId - id of event
   * @return {Promise}
   */
  del(eventId) {
    const [ev, ep] = this.validateId(eventId, &apos;eventId&apos;);
    if (!ev) { return ep; }

    const url = urlJoin(NAMESPACE, ENDPOINT_EVENT, eventId);
    return this.http.delete(url);
  }

  /**
   * Get a list of all Tickets. When called by an authenticated user, it will return all
   * Tickets that have that user as that `purchaserGwid`. When called by an Admin, it
   * will return all tickets. Both responses are filterable with the optional query
   * paramters.
   *
   * @param {Object} [opts] - options object
   * @param {Boolean} [opts.isRedeemed] -
   *   a Boolean representing whether the ticket has been redeemed. Only tickets with
   *   the given redemption status will be returned.
   * @param {Number} [opts.page] -
   *   an Integer indicating which page of results should be returned
   * @param {Number} [opts.perPage] -
   *   an Integer indicating how many results should be returned per request
   * @param {String} [opts.purchaserGwid] -
   *   is the GWID String of the user who purchased the tickets. Only tickets with the
   *   given purchaser will be returned.
   * @param {String} [opts.startsBefore] -
   *   an ISO-8601 formatted String given in local time without a timezone designator.
   *   Only tickets in categories occurring before the given timestamp will be returned
   * @param {String} [opts.startsAfter] -
   *   an ISO-8601 formatted String given in local time without a timezone designator.
   *   Only tickets in categories occurring after the given timestamp will be returned.
   * @return {Promise}
   */
  listAllTickets(opts = {}) {
    const _opts = only([&apos;isRedeemed&apos;, &apos;page&apos;, &apos;perPage&apos;, &apos;purchaserGwid&apos;,
                        &apos;startsBefore&apos;, &apos;startsAfter&apos;], opts);

    const url = urlJoin(NAMESPACE, ENDPOINT_TICKET);
    return this.http.get(url, { params: _opts });
  }

  /**
   * Unsubscribe an email address from all communication from a specific Event host.
   *
   * @param  {String} email - email address that wishes to unsubscribe
   * @param  {Object} [opts] - unsubscribe options
   * @param  {Object} [opts.invitationId] -
   *   UUID String unique identifier of the Invitation that triggered the
   *   unsubscribe request
   * @param  {Object} [opts.messageId] -
   *   UUID String unique identifier of the Message that triggered the
   *   unsubscribe request
   * @return {[type]}
   */
  unsubscribe(email, opts = {}) {
    const valid = validEmail(email) &amp;&amp; (typeof opts === &apos;object&apos;);

    if (!valid) {
      const response = this.http.generateErrorResponse({
        valid: false,
        fields: [&apos;email&apos;, &apos;opts&apos;],
        msg: [`Valid \`email\` and \`opts\` are required. Passed email (${email}).
               and opts (${opts})`]
      });

      return Promise.reject(response);
    }

    const { invitationId, messageId } = opts;

    // Only allow users to use one type of ID to unsubscribe, not both
    if (invitationId &amp;&amp; messageId) {
      const response = this.http.generateErrorResponse({
        valid: false,
        fields: [&apos;invitationId&apos;, &apos;messageId&apos;],
        msg: [`Must unsubscribe via \`invitationId\` or \`messageId\`, not both.`]
      });

      return Promise.reject(response);
    }

    const url = urlJoin(NAMESPACE, ENDPOINT_HOST_UNSUBSCRIBE);
    return this.http.get(url, { params: { email, invitationId, messageId } });
  }
}

mixin(
  Event,
  EventCategory,
  EventInvitation,
  EventMessage,
  EventTicket
);

export default Event;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.5)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
