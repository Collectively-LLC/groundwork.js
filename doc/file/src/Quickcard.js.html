<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Quickcard.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/thegroundwork/groundwork.js.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Auth.js~Auth.html">Auth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Dictionary.js~Dictionary.html">Dictionary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Donation.js~Donation.html">Donation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Event.js~Event.html">Event</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/EventCategory.js~EventCategory.html">EventCategory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/EventInvitation.js~EventInvitation.html">EventInvitation</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/EventMessage.js~EventMessage.html">EventMessage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/EventTicket.js~EventTicket.html">EventTicket</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Groundwork.js~Groundwork.html">Groundwork</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Http.js~Http.html">Http</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Payment.js~Payment.html">Payment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Profile.js~Profile.html">Profile</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Quickcard.js~Quickcard.html">Quickcard</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/SchemaUtils.js~SchemaUtils.html">SchemaUtils</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Subscription.js~Subscription.html">Subscription</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Supporter.js~Supporter.html">Supporter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-deprecate">deprecate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-epoch">epoch</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-has">has</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isApiVersion">isApiVersion</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isEmpty">isEmpty</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-max">max</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-mixin">mixin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-normalizeUrl">normalizeUrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-only">only</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-urlJoin">urlJoin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-validEmail">validEmail</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_CATEGORY">ENDPOINT_CATEGORY</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_EVENT">ENDPOINT_EVENT</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_HOST_UNSUBSCRIBE">ENDPOINT_HOST_UNSUBSCRIBE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_INVITATION">ENDPOINT_INVITATION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_MESSAGE">ENDPOINT_MESSAGE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ENDPOINT_TICKET">ENDPOINT_TICKET</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NAMESPACE">NAMESPACE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_URL">API_URL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-API_VERSION">API_VERSION</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTH_ACCESS_TOKEN">AUTH_ACCESS_TOKEN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTH_GWID">AUTH_GWID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AUTH_TOKEN_TYPE">AUTH_TOKEN_TYPE</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-CONFIG_AUTH">CONFIG_AUTH</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DEFAULT_API_URL">DEFAULT_API_URL</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-FACEBOOK_APP_ID">FACEBOOK_APP_ID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-OAUTH_CLIENT_ID">OAUTH_CLIENT_ID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RE_API_VERSION">RE_API_VERSION</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Quickcard.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import Payment from &apos;./Payment&apos;;
import schema from &apos;./schema/quickcard&apos;;
import schemaPay from &apos;./schema/quickcardPay&apos;;
import { urlJoin, has, only, epoch, max } from &apos;./utils&apos;;

/** @type {String} - API endpoint for resource */
const ENDPOINT_QUICKCARD = &apos;quickcards&apos;;

/**
 * Create and view quickcards
 *
 * list(opts) - get a filtered list of quickcards
 * create(quickcard) - create a new quickcard
 * fetch(id) - fetch a quickcard object
 *
 */
export default class Quickcard extends Payment {
  /**
   * Fetch a collection of Quickcard objects for a specific gwid. We try
   * to enforce the inclusion of a gwid if one is present in CONFIG_AUTH
   *
   * @param {Object} opts
   * @param {String} opts.gwid - gwid is required
   * @param {String} [opts.email] - filter on email
   * @param {Number} [opts.page] - page number
   * @param {Number} [opts.perPage] - quickcards per page
   * @return {Promise}
   */
  list(opts = {}) {
    const params = only([&apos;gwid&apos;, &apos;email&apos;, &apos;page&apos;, &apos;perPage&apos;],
                     this.attachIdentity(opts));

    // Allow opts to Override the gwid from config
    if (has(opts, &apos;gwid&apos;)) { params.gwid = opts.gwid; }

    // Max 50 p/page
    if (has(opts, &apos;perPage&apos;)) { params.perPage = max(opts.perPage); }

    // Failsafe to force gwid property into place no matter what
    if (!has(params, &apos;gwid&apos;)) { params.gwid = undefined; }

    const url = urlJoin(this.namespace, ENDPOINT_QUICKCARD);
    return this.fetchCollection(url, params);
  }

  /**
   * Fetch a list of all donations made for a quickcard
   *
   * @param {String} id - quickcard id
   * @return {Promise}
   */
  listDonations(id = &apos;&apos;) {
    // Must have an id
    const [idv, idp] = this.validateId(id);
    if (!idv) { return idp; }

    const url = urlJoin(this.namespace, ENDPOINT_QUICKCARD, id, &apos;donations&apos;);
    return this.fetchCollection(url);
  }

  /**
   * Fetch a single Quickcard object
   *
   * @param {String} id - quickcard id
   * @return {Promise}
   */
  fetch(id = &apos;&apos;) {
    // Must have an id
    const [idv, idp] = this.validateId(id);
    if (!idv) { return idp; }

    const url = urlJoin(this.namespace, ENDPOINT_QUICKCARD, id);
    return this.fetchCollection(url);
  }

  /**
   * POST a quickcard record to the API
   *
   * User must be authed / have a gwid
   *
   * The passed in form object will be validated. If it fails, a mock response
   * with any errors will be sent back in a rejected Promise. This is to present
   * the least amount of surprise to the developer.
   *
   * Note: All of the values in the object passed to the method should have had
   * their types coerced already or validation will fail.
   *
   * @example
   * // validation fail
   * donation.create({}).catch((err) =&gt; console.log(err));
   * // =&gt; { status: 400, data: { error: { valid: false, ... } } ... }
   *
   * @param {Object} [quickcard]
   * @return {Promise}
   */
  create(quickcard = {}) {
    const _quickcard = this.attachIdentity(quickcard);
    const checkQuickcard = this.validatePayment(_quickcard, schema);

    // Return a mock error response with validation errors
    if (checkQuickcard.valid === false) {
      const response = this.http.generateErrorResponse(checkQuickcard);
      return Promise.reject(response);
    }

    const url = urlJoin(this.namespace, ENDPOINT_QUICKCARD);
    return this.http.post(url, _quickcard);
  }

  /**
   * Delete (cancel) a quickcard
   *
   * Note: Quickcards can be cancelled on a date in the future by passing
   * additional arguments.
   *
   * @example
   * // Cancel quickcard abc123 today
   * del(&apos;abc123&apos;);
   *
   * // Set a cancellation date of Oct 13, 2015 for quickcard abc123
   * del(&apos;abc123&apos;, 2015, 10, 13)
   *
   * @param {String} id - quickcard id
   * @param {...time&lt;number&gt;} [time] - year, month, day for a specific epoch
   * @return {Promise}
   */
  del(id = &apos;&apos;, ...time) {
    const date = epoch.apply(null, time);

    // Must have an id
    const [idv, idp] = this.validateId(id);
    if (!idv) { return idp; }

    const url = urlJoin(this.namespace, ENDPOINT_QUICKCARD, id);
    return this.http.put(url, { deleted: date });
  }

  /**
   * Make a Quick Donate Payment - The Quick Donate endpoint can only be used if
   * two conditions are met. First, the request needs to come from an
   * authenticated user. Second, that authenticated user must have a stored and
   * active Card object.
   *
   * @param {String} id - QuickCard id
   * @param {Object} payment - payment object for QuickCard
   * @return {Promise}
   */
  pay(id, payment = {}) {
    // Must have an id
    const [idv, idp] = this.validateId(id);
    if (!idv) { return idp; }

    const _payment = this.attachIdentity(payment);

    // Validate payment and reject if errors
    const [pv, pp] = this.validateSchema(_payment, schemaPay);
    if (!pv) { return pp; }

    const url = urlJoin(this.namespace,
                        ENDPOINT_QUICKCARD,
                        id,
                        &apos;donations&apos;);

    return this.http.post(url, _payment);
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.5)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
